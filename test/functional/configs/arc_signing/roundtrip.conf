.include(duplicate=append,priority=0) "{= env.TESTDIR =}/configs/plugins.conf"

# ARC signing configuration with both RSA and ed25519 keys
arc {
  sign_authenticated = true;
  use_http_headers = true;
  allow_headers_fallback = true;

  domain {
    # RSA key for cacophony.za.org
    cacophony.za.org {
      path = "{= env.TESTDIR =}/configs/dkim.key";
      selector = "dkim";
    }
    # ed25519 key for ed25519.za.org
    ed25519.za.org {
      path = "{= env.TESTDIR =}/configs/dkim_ed25519.key";
      selector = "dkim";
    }
  }

  check_pubkey = false;  # Disable pubkey checking for tests
  allow_pubkey_mismatch = true;
  allow_username_mismatch = true;  # Allow user domain to differ from signing domain
}

# Settings for ARC verification phase
settings {
  arc_verify {
    id = "arc_verify";
    apply {
      symbols_enabled = ["ARC_CHECK", "ARC_ALLOW", "ARC_REJECT", "ARC_INVALID", "ARC_DNSFAIL", "ARC_NA"];
      symbols_disabled = ["ARC_SIGNED"];
    }
  }
}
