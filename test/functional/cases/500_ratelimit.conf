*** Settings ***
Suite Setup     Rspamd Setup
Suite Teardown  Rspamd Teardown
Library         ${RSPAMD_TESTDIR}/lib/rspamd.py
Resource        ${RSPAMD_TESTDIR}/lib/rspamd.robot
Variables       ${RSPAMD_TESTDIR}/lib/vars.py

*** Variables ***
${CONFIG}               ${RSPAMD_TESTDIR}/configs/ratelimit.conf
${MESSAGE}              ${RSPAMD_TESTDIR}/messages/ham.eml
${RSPAMD_SCOPE}         Suite
${SETTINGS_REPLIES}     {symbols_enabled = [RATELIMIT_CHECK, RATELIMIT_UPDATE]}

*** Test Cases ***
CHECK BASIC
  FOR  ${index}  IN RANGE  5
    Scan File  ${HAM_MESSAGE}
    ...  Settings=${SETTINGS_RATELIMIT}
    ...  Rcpt=foobar@example.net
    Expect Action  no action
  END
  Scan File  ${HAM_MESSAGE}
  ...  Settings=${SETTINGS_RATELIMIT}
  ...  Rcpt=foobar@example.net
  Expect Action  soft reject
  Sleep 1s
  Scan File  ${HAM_MESSAGE}
  ...  Settings=${SETTINGS_RATELIMIT}
  ...  Rcpt=foobar@example.net
  Expect Action  no action

